//
//  DayScheduleTests.swift
//  EasitOpenTests
//
//  Created by nissim amira on 04/12/2025.
//

import XCTest
@testable import EasitOpen

final class DayScheduleTests: XCTestCase {
    
    func testIsOpenDuringBusinessHours() {
        // 9 AM - 5 PM schedule
        let schedule = DaySchedule(weekday: 2, openTime: 540, closeTime: 1020)
        
        // 10 AM (600 minutes) - should be open
        XCTAssertTrue(schedule.isOpen(at: 600))
        
        // 3 PM (900 minutes) - should be open
        XCTAssertTrue(schedule.isOpen(at: 900))
        
        // 8 AM (480 minutes) - should be closed
        XCTAssertFalse(schedule.isOpen(at: 480))
        
        // 6 PM (1080 minutes) - should be closed
        XCTAssertFalse(schedule.isOpen(at: 1080))
    }
    
    func testIsOpenAtExactOpeningTime() {
        let schedule = DaySchedule(weekday: 2, openTime: 540, closeTime: 1020)
        
        // Exactly 9 AM - should be open
        XCTAssertTrue(schedule.isOpen(at: 540))
    }
    
    func testIsClosedAtExactClosingTime() {
        let schedule = DaySchedule(weekday: 2, openTime: 540, closeTime: 1020)
        
        // Exactly 5 PM - should be closed (< not <=)
        XCTAssertFalse(schedule.isOpen(at: 1020))
    }
    
    func testIsOpenWhenMarkedClosed() {
        let schedule = DaySchedule(weekday: 1, openTime: 0, closeTime: 0, isClosed: true)
        
        // Should always be closed regardless of time
        XCTAssertFalse(schedule.isOpen(at: 600))
        XCTAssertFalse(schedule.isOpen(at: 0))
        XCTAssertFalse(schedule.isOpen(at: 1439))
    }
    
    func testTimeFormatting() {
        let schedule = DaySchedule(weekday: 2, openTime: 540, closeTime: 1020)
        
        // 540 minutes = 9:00 AM
        XCTAssertEqual(schedule.openTimeFormatted, "9:00 AM")
        
        // 1020 minutes = 5:00 PM
        XCTAssertEqual(schedule.closeTimeFormatted, "5:00 PM")
    }
    
    func testMidnightFormatting() {
        let schedule = DaySchedule(weekday: 1, openTime: 0, closeTime: 720)
        XCTAssertEqual(schedule.openTimeFormatted, "12:00 AM")
    }
    
    func testNoonFormatting() {
        let schedule = DaySchedule(weekday: 1, openTime: 720, closeTime: 1020)
        XCTAssertEqual(schedule.openTimeFormatted, "12:00 PM")
    }
    
    func testAfternoonTimeFormatting() {
        // 2:30 PM = 870 minutes
        let schedule = DaySchedule(weekday: 1, openTime: 870, closeTime: 1080)
        XCTAssertEqual(schedule.openTimeFormatted, "2:30 PM")
    }
    
    func testEarlyMorningFormatting() {
        // 6:45 AM = 405 minutes
        let schedule = DaySchedule(weekday: 1, openTime: 405, closeTime: 900)
        XCTAssertEqual(schedule.openTimeFormatted, "6:45 AM")
    }
}
